<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, maximum-scale=1.0" />
    <link rel="stylesheet" href="prism.css">
    <script defer src="prism.js"></script>

    <title>Stefan D'Souza's HCDE 439 Physical Computing Page!</title>

    <link href="style.css" rel="stylesheet" type="text/css" />
  </head>
  <body>
    <style>
      p {
          margin-bottom: 40px;
      }

      h1 {
          margin-bottom: 20px;
      }

      h2 {
          margin-bottom: 20px;
      }

      h3 {
          margin-bottom: 10px;
      }
      </style>

    <h1>Stefan D'Souza's Assignment 6</h1>
    <h2>Assignment Recording Video</h2>

    <video width="640" height="360" controls>
      <source src="a6WebVideo.mp4" type="video/mp4">
    </video>
  
    <p>Here is a video of my circuit, where the lights scale in brightness based on how close you are to the capacitive sensor</p>


    <h2>Assignment Static Image</h2>

    <img src="a6WebStaticImage.jpg" alt="Static Image of an electronic circuit">
    <p>
      Above is a static image of my circuit. I run two main parts. The first is a circuit used for capacitive sensing. It links a two pins to a 1M Ohm resistor and connects a measuring spoon in through alligator clips. The second section is a LED strip. As we get closer to the capacitive sensor made out of the spoon, the LED's get brighter.</p>

    <h2>Assignment Schematic</h2>

    <img src="a5TransistorsSchematicA.PNG" alt="Circuit Diagram showing two circuits">
    <img src="a5TransistorsSchematicB.PNG" alt="Circuit Diagram showing two circuits">

    <p>
      Above is the schematic image of my circuit. The second schematic is based on the class image of how the schematic was pictured, which is why power and ground are not represented in the circuit diagram.</p>
    
    <p>The 1M Ohm resistor is based mostly on what we learned in class, but to my understanding it mostly serves to keep the circuit at a safe level, and to make sure we don't end the circuit with an overcharged capacitor that might pose a risk at a greater scale. </p>    

    <p>I'll breakdown the upper schematic a bit more: The power output is 12V. I use the LED strip with 300 white leds, which are broken down into sets of 3 in series, with each set in parallel. 3.3Voltage Drop * 3 lights results in a voltage of 2.1 through each series of lights, which have a 181 ohm resistor in them netting 2.1/181 = 11.6 miliamps of current. Multiplying this by 100 sets makes it 1.16 total Amps, which is in line given that the max output of our power supply is 2 amps. We can expect to see 12 V across the circuit, with it being pretty close to 12V across the led strip given that there's negligble other resistance in the circuit (the transistor doesn't have too much). Within individual 3 sets, we would see a voltage of 2.1 across the resistor and 3.3 on each LED. The current going in and coming out of the led strips is 1.16 Amps, which is also what we would expect in and out of the transistor when current is moving.</p>
    <p>I am using under 2 amps of current, the transistor can throughflow much more (discussed in q1), and also has a avalanche and continuos drain rating of 29+ Amps (as in all the ratings are higher than 29)</p>

    <h2>Code</h2>
    <p>Citations: I have looked at the starter button code from class.</p>
    <pre><code class="language-arduino">
      int xPin = A1; // sets input x pin
      int yPin = A0; // sets input y pin

      void setup() {
        Serial.begin(9600); // starts serial
        pinMode(6, OUTPUT); // sets pin 6 to output
      }

      void loop() {
        int serialRead = 99999; // sets a garbage val for serialRead

        if (Serial.available()){ // if serial is available
          serialRead = Serial.read(); // reads serial value
        }
          
        if (serialRead == 1) { // if the serial value is 1
          digitalWrite(6, HIGH); // we want to turn on the led
        } else if (serialRead == 0) { // if serial val is not 1
          digitalWrite(6, LOW); // we turn off LED
        }

        int xValue = analogRead(xPin); // collect x value from joystick
        int yValue = analogRead(yPin); // collect y value from joystick
        
        Serial.print(xValue); // prints xVal
        Serial.print(","); // prints comma
        Serial.println(yValue); // prints yVal and newline character to filter for

        delay(10); // delays slightly
      }
    </code></pre>

    <pre><code class="language-arduino">
    int xPin = A1; // sets input x pin
    int yPin = A0; // sets input y pin

    void setup() {
      Serial.begin(9600); // starts serial
      pinMode(6, OUTPUT); // sets pin 6 to output
    }

    void loop() {
      int serialRead = 99999; // sets a garbage val for serialRead

      if (Serial.available()){ // if serial is available
        serialRead = Serial.read(); // reads serial value
      }
        
      if (serialRead == 1) { // if the serial value is 1
        digitalWrite(6, HIGH); // we want to turn on the led
      } else if (serialRead == 0) { // if serial val is not 1
        digitalWrite(6, LOW); // we turn off LED
      }

      int xValue = analogRead(xPin); // collect x value from joystick
      int yValue = analogRead(yPin); // collect y value from joystick
      
      Serial.print(xValue); // prints xVal
      Serial.print(","); // prints comma
      Serial.println(yValue); // prints yVal and newline character to filter for

      delay(10); // delays slightly
    }
    </code></pre>

    <pre><code class="language-arduino">
    const BAUD_RATE = 9600; // This should match the baud rate in your Arduino sketch

    let port, connectBtn; // Declare global variables
    
    function setup() {
      setupSerial(); // Run our serial setup function (below)
    
      // Create a canvas that is the size of our browser window.
      // windowWidth and windowHeight are p5 variables
      createCanvas(windowWidth, windowHeight);
    
      // p5 text settings. BOLD and CENTER are constants provided by p5.
      // See the "Typography" section in the p5 reference: https://p5js.org/reference/
      textFont("system-ui", 50);
      textStyle(BOLD);
      textAlign(CENTER, CENTER);
    }
    
    function draw() {
      const portIsOpen = checkPort(); // Check whether the port is open (see checkPort function below)
      if (!portIsOpen) return; // If the port is not open, exit the draw loop
    
      let garbage = port.readUntil("\n"); // collects a garbage read in case we start reading partway through a line
      let str = port.readUntil("\n"); // Read from the port until the newline
      if (str.length == 0) return; // If we didn't read anything, return.
    
      
      let [x, y] = str.split(','); // string split on the comma
    
      let xVal = Number(x); // converts x value to a number
      let yVal = Number(y); // converts y value to a number
    
      let neutral = false; // defines our default case (hard coded to joystick)
      // if we have all these traits, we have a neutral state
      if (yVal === 505 && (xVal === 502 || xVal === 503)) {neutral = true};
    
      // if neutral state
      if (neutral === true) {
        background("blue"); // sets background color
        // sets text
        text("Joystick is Neutral", windowWidth / 2, windowHeight / 2);
      } else if (xVal > yVal) { // x is greater case
        background("coral"); // sets background color
        let output = "X Wins: " + xVal + " > " + yVal; // generates output 
        text(output, windowWidth / 2, windowHeight / 2); // prints text to screen
      } else { // all other cases
        background("darkcyan"); // sets background
        let output = "Y Wins: " + yVal + " > " + xVal; // generates output 
        text(output, windowWidth / 2, windowHeight / 2); // outputs output
      }
    
      if (mouseIsPressed){ // when the mouse is pressed
        port.write(1); // we write "1"
      } else { // if not pressed
        port.write(0); // we write 0
      }
    
    }
    
    // Three helper functions for managing the serial connection.
    
    function setupSerial() {
      port = createSerial();
    
      // Check to see if there are any ports we have used previously
      let usedPorts = usedSerialPorts();
      if (usedPorts.length > 0) {
        // If there are ports we've used, open the first one
        port.open(usedPorts[0], BAUD_RATE);
      }
    
      // create a connect button
      connectBtn = createButton("Connect to Arduino");
      connectBtn.position(5, 5); // Position the button in the top left of the screen.
      connectBtn.mouseClicked(onConnectButtonClicked); // When the button is clicked, run the onConnectButtonClicked function
    }
    
    function checkPort() {
      if (!port.opened()) {
        // If the port is not open, change button text
        connectBtn.html("Connect to Arduino");
        // Set background to gray
        background("gray");
        return false;
      } else {
        // Otherwise we are connected
        connectBtn.html("Disconnect");
        return true;
      }
    }
    
    function onConnectButtonClicked() {
      // When the connect button is clicked
      if (!port.opened()) {
        // If the port is not opened, we open it
        port.open(BAUD_RATE);
      } else {
        // Otherwise, we close it!
        port.close();
      }
    }
    
    </code></pre>   
  </body>
</html>
